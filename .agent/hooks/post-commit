#!/bin/sh
# Post-commit automation chain
# Runs: Mirror ‚Üí Facts ‚Üí Registry Sync
echo "========================================================"
echo "ü§ñ POST-COMMIT AUTOMATION"
echo "========================================================"

# 1. Mirror codebase to GCS
echo "[1/3] Syncing codebase to GCS..."
/usr/bin/python3 context-management/tools/archive/archive.py mirror || echo "‚ö†Ô∏è Mirror failed (Check setup)"

# 2. BARE: Update repository facts
echo "[2/3] Loading repository facts..."
/usr/bin/python3 .agent/tools/fact_loader.py > /dev/null 2>&1 && echo "‚úì Facts loaded" || echo "‚ö†Ô∏è FactLoader failed"

# 3. Sync registry to GCS (enables Cloud Function auto-boost)
echo "[3/3] Syncing registry to GCS..."
/usr/bin/python3 .agent/tools/cloud/sync_registry.py --inbox-only 2>/dev/null && echo "‚úì Registry synced" || echo "‚ö†Ô∏è Registry sync failed (run manually: python .agent/tools/cloud/sync_registry.py)"

echo "========================================================"
echo "‚úì Post-commit complete"
echo "========================================================"
