id: OPP-059
title: "Fix ATOMS view mode toggle - Original data not restored"
source: DIAGNOSTIC
discovered_at: "2026-01-23T08:50:00Z"
category: VISUALIZATION
description: |
  The ATOMS view mode toggle button disables FILE_VIZ but never restores
  the original atom graph data. After switching FILES -> ATOMS, the graph
  still displays file nodes (59) instead of atoms (4340).

  Root cause: sidebar.js:574-582 only calls:
    FILE_VIZ.graphMode = 'atoms';  // This property doesn't exist!
    FILE_VIZ.setEnabled(false);    // Only disables, doesn't restore data

  Missing: Graph.graphData({nodes: DM.getNodes(), links: DM.getLinks()})

  Evidence:
  - After clicking FILES then ATOMS, Graph.graphData().nodes.length = 59
  - DM.getNodes().length = 4340 (original data is preserved)
  - Manual Graph.graphData({nodes: DM.getNodes(), links: DM.getLinks()}) works

  Fix: Add data restoration call to setViewMode('atoms') branch
suggested_action: "Add Graph.graphData({nodes: DM.getNodes(), links: DM.getLinks()}) to atoms branch"
urgency: HIGH
files_affected:
  - "standard-model-of-code/src/core/viz/assets/modules/sidebar.js"
related_to:
  - "OPP-058"
  - "File visualization system"

# --- 4D CONFIDENCE ---
confidence:
  factual: 100     # Verified + Gemini confirms "completely fails to reload"
  alignment: 90    # Core visualization feature
  current: 100     # Gemini: "Valid & Critical" - single line fix
  onwards: 85      # Fits file-level analysis roadmap
  overall: 85      # min(100, 90, 100, 85)
  verdict: ACCEPT

# --- AI VALIDATION ---
ai_validation:
  model: gemini-3-pro-preview
  date: 2026-01-23
  verdict: "VALID & CRITICAL - FILE_VIZ.setEnabled(false) cleans up visuals but does NOT restore graph topology. Graph retains file nodes. Must call Graph.graphData({nodes: DM.getNodes(), links: DM.getLinks()})."
  research_file: "standard-model-of-code/docs/research/gemini/docs/20260123_085448_validate_these_bugs_in_sidebar_js_and_file_viz_js.md"

# --- RESOLVED ---
status: COMPLETE
resolved_at: 2026-01-23T09:05:00Z
fix_applied: "Added explicit Graph.graphData({nodes, links}) restore in setViewMode('atoms') at sidebar.js:585-587"
verified: true
