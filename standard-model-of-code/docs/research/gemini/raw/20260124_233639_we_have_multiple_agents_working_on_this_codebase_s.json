{
  "_meta": {
    "saved_at": "2026-01-24T23:36:39.377337",
    "source": "gemini",
    "model": "gemini-3-pro-preview",
    "query": "We have multiple agents working on this codebase simultaneously. What coordination protocol should we follow for Phase 2 dead code cleanup? Current situation: research_engine.py deletion was attempted but files are being modified by other agents. What is the safest approach?",
    "query_length": 275,
    "checksum": "sha256:f33572824e3327e26b39a1433cc949e94a1bbbb68fb2d44d239cc467c4a674b8"
  },
  "response": {
    "content": "Based on the `PROJECT_elements` architecture and the `AGENT_KERNEL.md` directives, here is the coordination protocol for **Phase 2 Dead Code Cleanup** in a multi-agent environment.\n\n### ðŸ›‘ CRITICAL WARNING regarding `research_engine.py`\n\n**DO NOT DELETE `research_engine.py` YET.**\n\nAccording to **`context-management/docs/RESEARCH_SCHEMAS.md`**, this file is the active engine for the Research Schema system:\n> **Location:** `context-management/config/research_schemas.yaml`\n> **Engine:** `context-management/tools/ai/aci/research_engine.py`\n\nIf you are deleting it, you must first verify that `analyze.py` no longer imports it. Deleting it while other agents are running `analyze.py` research commands will cause immediate crashes.\n\n---\n\n### The Protocol: \"Atomic Claim & Isolation\"\n\nTo handle high-concurrency cleanup without stepping on other agents, use the **Task Registry + Branch Isolation** method.\n\n#### 1. The Claim (Semantic Lock)\nBefore touching a single file, you must semantically lock the intent in the registry.\n\n1.  **Check Active Tasks**: Read `.agent/registry/INDEX.md` or list active tasks.\n2.  **Claim the Cleanup**: Run the claim tool to signal intent.\n    ```bash\n    # If a task exists (e.g., TASK-125), claim it\n    .agent/tools/claim_task.sh TASK-125 agent-cleanup-01\n    ```\n    *If no task exists, create `TASK-CLEANUP-PHASE2.yaml` in `.agent/registry/active/`.*\n\n#### 2. The Isolation (Git Branching)\nDo **NOT** perform destructive cleanup directly on `main` while other agents are active.\n\n1.  **Create a Branch**:\n    ```bash\n    git checkout -b chore/phase2-dead-code-cleanup\n    ```\n2.  **Why**: This isolates your deletions. If another agent modifies `research_engine.py` on `main`, you will face a merge conflict later (which is safe) rather than a runtime crash now (which is fatal).\n\n#### 3. The Verification (The Forensic Check)\nUse the \"Surgeon\" mode to prove the code is dead before deletion.\n\n```bash\n# 1. Search for references (excluding the file itself)\ngrep -r \"research_engine\" . --exclude=\"research_engine.py\" --exclude-dir=\".git\"\n\n# 2. Check imports in the ACI module\ngrep \"research_engine\" context-management/tools/ai/aci/__init__.py\n```\n*If these return hits, the code is ALIVE. Do not delete.*\n\n#### 4. The Execution (Atomic Deletion)\nIf verification passes (0 hits or only legacy docs):\n\n1.  **Delete**: `rm context-management/tools/ai/aci/research_engine.py`\n2.  **Test Immediately**:\n    ```bash\n    # Run the brain tests to ensure no import errors\n    cd standard-model-of-code\n    pytest ../context-management/tests/ -q  # Or equivalent path if tests exist\n    # OR run the tool to check for import crashes\n    python ../context-management/tools/ai/analyze.py --help\n    ```\n3.  **Commit Immediately**:\n    ```bash\n    git add .\n    git commit -m \"chore: delete dead code research_engine.py (verified unused)\"\n    ```\n\n#### 5. The Merge (Resolution)\nSwitch back to main and merge.\n\n```bash\ngit checkout main\ngit pull origin main  # Get changes from other agents\ngit merge chore/phase2-dead-code-cleanup\n```\n*If a conflict occurs (because another agent modified the file you just deleted), **keep the deletion** only if you are 100% sure their changes were to a dead file. Otherwise, abort and investigate.*\n\n### Summary Checklist for Agent\n\n1.  [ ] **Claim** task in `.agent/registry`.\n2.  [ ] **Branch** to `chore/cleanup`.\n3.  [ ] **Verify** usage via `grep` (Found references in `RESEARCH_SCHEMAS.md`? **STOP**).\n4.  [ ] **Delete** & **Run** `analyze.py --help` to verify runtime integrity.\n5.  [ ] **Commit** & **Merge**.",
    "mode": "standard"
  }
}