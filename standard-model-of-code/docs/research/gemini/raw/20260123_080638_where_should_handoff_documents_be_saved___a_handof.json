{
  "_meta": {
    "saved_at": "2026-01-23T08:06:38.403241",
    "source": "gemini",
    "model": "gemini-2.5-pro",
    "query": "WHERE SHOULD HANDOFF DOCUMENTS BE SAVED?\n\nA handoff is knowledge transfer from one agent session to another. It includes:\n- Current state of work\n- Decisions made and rationale\n- Next steps\n- Research sources\n- How to continue\n\nAnalyze the existing .agent/ structure and propose:\n1. WHERE should handoffs live? (new directory? existing location?)\n2. WHAT format? (YAML? Markdown? Both?)\n3. HOW should they be named? (by date? by task? by agent?)\n4. HOW do they relate to RUN records in .agent/runs/?\n\nConsider the existing patterns:\n- runs/ has session logs\n- specs/ has design documents\n- registry/ has tasks\n- intelligence/ has truths\n\nPropose a canonical location that fits the architecture.",
    "query_length": 694,
    "checksum": "sha256:7700902b8dbd561ceacfb5817668369d5f2d00ba7ef95dd118f8109498b220ef"
  },
  "response": {
    "content": "As a senior software engineer, I have analyzed the provided codebase context. Here is my analysis and recommendation regarding handoff documents.\n\nThe existing architecture already has a clear and robust pattern for managing handoffs. Creating a new, separate location for \"handoff documents\" would be counter-productive and violate the established principles of the system.\n\n**The handoff information is an integral part of the RUN record and should be saved within the `.agent/runs/RUN-*.yaml` file itself.**\n\nHere is a detailed breakdown addressing your specific questions:\n\n---\n\n### 1. WHERE should handoffs live?\n\nHandoffs live inside the existing `runs/` directory, specifically within the YAML file corresponding to the agent's session.\n\n**Rationale:**\n\n*   **Task/Run Separation:** The `KERNEL.md` document clearly defines a `RUN` as \"One agent's attempt to advance a task\". A handoff is the concluding state of that attempt. Therefore, it belongs within the `RUN` record to maintain a complete, atomic log of that session.\n*   **Single Source of Truth:** The `KERNEL.md` states \"Never skip the RUN record - Even quick fixes get documented.\" Placing handoff data inside the RUN record ensures that everything related to a single agent session (the log of what was done and the instructions for what to do next) is in one place. Creating a separate handoff file would introduce a second source of truth that could become desynchronized.\n*   **Explicit Instructions:** The \"Agent Responsibilities\" section in `KERNEL.md` is unambiguous. Under \"Ending a Session,\" it explicitly directs the agent to:\n    > 1. Update RUN with:\n    >    - `handoff.summary`: What was accomplished\n    >    - `handoff.next_steps`: What the next agent should do\n    >    - `handoff.artifacts`: Files created/modified\n\nThis confirms that the `handoff` is a structured data block *inside* the RUN record.\n\n### 2. WHAT format?\n\nThe format is **YAML**, consistent with all other RUN records.\n\n**Rationale:**\n\n*   **Machine Readability:** The system is built on a \"Concepts / Objects Duality\" where objects are instances and records, often in YAML format (e.g., `TASK-001.yaml`, `RUN-*.yaml`). This structured format allows other tools and agents to parse the handoff information reliably.\n*   **Schema Enforcement:** `manifest.yaml` points to a schema for runs: `.agent/schema/run.schema.yaml`. This implies the RUN record, including its `handoff` section, has a defined, machine-enforceable structure.\n*   **Readability:** YAML fields can contain multi-line strings with Markdown for human-readable summaries and next steps, offering the best of both worlds. For example:\n    ```yaml\n    # In runs/RUN-20260124-103000-claude.yaml\n    handoff:\n      summary: |\n        - Implemented the basic structure for the Discovery Inbox.\n        - Created the `.agent/registry/inbox/` directory.\n        - Wrote a draft `opportunity.schema.yaml`.\n      next_steps: |\n        1. Finalize the `opportunity.schema.yaml` by adding validation rules.\n        2. Implement the `promote_opportunity.sh` script.\n        3. Test the full promotion workflow.\n      artifacts:\n        - .agent/registry/inbox/.gitkeep\n        - .agent/schema/opportunity.schema.yaml\n    ```\n\n### 3. HOW should they be named?\n\nThey are not named separately. They are part of a RUN record, which is named according to the established convention: `RUN-{timestamp}-{agent}.yaml`.\n\n**Rationale:**\n\n*   **Traceability:** The RUN file's name already provides critical metadata: *when* the session ended and *which agent* performed the work. This automatically links the handoff to its context.\n*   **Consistency:** The `manifest.yaml` specifies a `run_id_pattern`: `^RUN-[0-9]{8}-[0-9]{6}-[a-z]+$`. Adhering to this prevents architectural drift and ensures all session records are discoverable by system tools.\n\n### 4. HOW do they relate to RUN records?\n\nThe handoff is not merely \"related\" to a RUN record; **it is a dedicated section within the RUN record.** It represents the final state and forward-looking guidance of that specific run.\n\n**The Workflow:**\n\n1.  An agent claims a `TASK`.\n2.  The agent creates a new `RUN-*.yaml` file in `.agent/runs/`.\n3.  The agent logs its work in the `progress.step_log` section of the `RUN` file.\n4.  Upon finishing its session, the agent populates the `handoff` section within that same `RUN-*.yaml` file.\n5.  The agent sets the `status` of the `RUN` to `HANDOFF_READY`.\n6.  The next agent assigned to the `TASK` can easily find the most recent `RUN` record associated with that task, read its `handoff` section, and resume work without ambiguity.\n\n### Conclusion\n\nThe architecture is designed for the handoff to be an inseparable part of the session log (`RUN` record). This approach provides atomicity, traceability, and consistency, leveraging the existing structure without adding unnecessary complexity. Any attempt to create separate handoff documents would be a deviation from the core principles outlined in `KERNEL.md`.",
    "mode": "standard"
  }
}