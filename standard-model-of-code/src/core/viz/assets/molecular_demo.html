<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>NVIDIA-Class Molecular Viz - Project Elements</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000510;
            font-family: 'Inter', sans-serif;
            color: #fff;
        }

        canvas {
            display: block;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .hud-panel {
            background: rgba(0, 20, 40, 0.85);
            border: 1px solid #00ff88;
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            pointer-events: auto;
            max-width: 300px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }

        h1 {
            margin: 0 0 10px;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #00ff88;
        }

        h2 {
            margin: 10px 0 5px;
            font-size: 0.9rem;
            color: #00ccff;
        }

        button {
            background: #003322;
            color: #00ff88;
            border: 1px solid #00ff88;
            padding: 8px 12px;
            margin: 4px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        button:hover {
            background: #00ff88;
            color: #000;
            box-shadow: 0 0 15px #00ff88;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: #aacce0;
        }

        #molecule-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            border-top: 1px solid #005544;
            padding-top: 5px;
        }

        .mol-item {
            padding: 4px;
            border-bottom: 1px solid #003344;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
        }

        .mol-item:hover {
            background: rgba(0, 255, 136, 0.1);
            color: #fff;
        }

        .mol-item.active {
            background: rgba(0, 255, 136, 0.3);
            color: #fff;
            font-weight: bold;
        }

        /* NVIDIA Green Accent */
        .nv-accent {
            color: #76b900;
        }
    </style>

    <!-- Import Map for Modules -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>

    <div id="ui-layer">
        <div class="hud-panel">
            <h1><span class="nv-accent">NVIDIA</span> Bio-Core</h1>
            <div class="stat-row"><span>System Status:</span> <span style="color:#0f0">ONLINE</span></div>
            <div class="stat-row"><span>GPU Acceleration:</span> <span style="color:#0f0">ENABLED</span></div>
            <div class="stat-row"><span>Water Particles:</span> <span id="water-count">5000</span></div>
            <div class="stat-row"><span>Active Molecules:</span> <span id="mol-count">0</span></div>

            <h2>Control Deck</h2>
            <button id="btn-add-water">Add Water (+1k)</button>
            <button id="btn-clear">Clear System</button>
            <button id="btn-sim-physics">Simulate Physics (Warp)</button>

            <h2>Molecular Database (Top 300)</h2>
            <div id="molecule-list">
                <!-- Dynamically Populated -->
            </div>
        </div>

        <div class="hud-panel" style="align-self: flex-end;">
            <h2>Intelligence Output</h2>
            <div id="ai-log"
                style="font-family: monospace; font-size: 0.7rem; color: #00ff88; height: 100px; overflow: hidden; display: flex; flex-direction: column-reverse;">
                <div>> System Ready.</div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';

        // --- Configuration ---
        const CONFIG = {
            waterCount: 4000,
            waterColor: 0x00aaff,
            bgColor: 0x000510,
            bloomStrength: 1.5,
            bloomRadius: 0.4,
            bloomThreshold: 0.85
        };

        // --- Database of "Top Molecules" (Mockup of 300) ---
        // Format: Name, Formula, AtomData (mocked as simple counts/structures for demo)
        const MOLECULES = [
            { name: "Water", formula: "H2O", atoms: [{ e: 'O', x: 0, y: 0, z: 0 }, { e: 'H', x: 0.8, y: 0.6, z: 0 }, { e: 'H', x: -0.8, y: 0.6, z: 0 }] },
            { name: "Caffeine", formula: "C8H10N4O2", complex: true },
            { name: "Glucose", formula: "C6H12O6", complex: true },
            { name: "Ethanol", formula: "C2H5OH", complex: true },
            { name: "Adenosine Triphosphate (ATP)", formula: "C10H16N5O13P3", complex: true },
            { name: "Carbon Dioxide", formula: "CO2", atoms: [{ e: 'C', x: 0, y: 0, z: 0 }, { e: 'O', x: 1.2, y: 0, z: 0 }, { e: 'O', x: -1.2, y: 0, z: 0 }] },
            { name: "Methane", formula: "CH4", atoms: [{ e: 'C', x: 0, y: 0, z: 0 }, { e: 'H', x: 1, y: 1, z: 1 }, { e: 'H', x: -1, y: -1, z: 1 }, { e: 'H', x: -1, y: 1, z: -1 }, { e: 'H', x: 1, y: -1, z: -1 }] },
            { name: "Benzene", formula: "C6H6", complex: true },
            { name: "DNA Base Pair (A-T)", formula: "Complex", complex: true },
            { name: "Hemoglobin Heme", formula: "Fe-Complex", complex: true }
        ];

        // Procedurally generate the rest to reach 100+ items for the list
        for (let i = 10; i < 300; i++) {
            MOLECULES.push({ name: `Synthetic Compound ${i}`, formula: `C${Math.floor(Math.random() * 20)}H${Math.floor(Math.random() * 40)}`, complex: true });
        }

        // --- Scene Setup ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(CONFIG.bgColor);
        scene.fog = new THREE.FogExp2(CONFIG.bgColor, 0.02);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 10, 20);

        const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ReinhardToneMapping;
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.5;

        // --- Post Processing ---
        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = CONFIG.bloomThreshold;
        bloomPass.strength = CONFIG.bloomStrength;
        bloomPass.radius = CONFIG.bloomRadius;

        const composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        // --- Lighting ---
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 2, 100);
        pointLight.position.set(10, 10, 10);
        scene.add(pointLight);

        const blueLight = new THREE.PointLight(0x0044ff, 5, 50);
        blueLight.position.set(-10, -5, -10);
        scene.add(blueLight);

        // --- Water Particle System (InstancedMesh) ---
        // Representing water as tiny fuzzy spheres (Orbitals)
        let waterSystem;
        const waterGeometry = new THREE.IcosahedronGeometry(0.1, 1);
        const waterMaterial = new THREE.MeshPhysicalMaterial({
            color: 0x00aaff,
            emissive: 0x001133,
            metalness: 0.1,
            roughness: 0.1,
            transmission: 0.6,
            thickness: 0.5,
            transparent: true,
            opacity: 0.4
        });

        function initWater(count) {
            if (waterSystem) scene.remove(waterSystem);
            waterSystem = new THREE.InstancedMesh(waterGeometry, waterMaterial, count);

            const dummy = new THREE.Object3D();
            for (let i = 0; i < count; i++) {
                dummy.position.set(
                    (Math.random() - 0.5) * 40,
                    (Math.random() - 0.5) * 40,
                    (Math.random() - 0.5) * 40
                );
                dummy.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
                const scale = 0.5 + Math.random() * 0.5;
                dummy.scale.set(scale, scale, scale);
                dummy.updateMatrix();
                waterSystem.setMatrixAt(i, dummy.matrix);
            }
            waterSystem.instanceMatrix.needsUpdate = true;
            scene.add(waterSystem);
            document.getElementById('water-count').innerText = count;
        }

        initWater(CONFIG.waterCount);

        // --- Active Molecules Container ---
        const activeMolecules = new THREE.Group();
        scene.add(activeMolecules);

        // --- Procedural Generation of "Complex" Molecules ---
        function generateProceduralMolecule(name) {
            const group = new THREE.Group();

            // Random structure generation (Metaphor for 'real' structure)
            const nodeCount = 5 + Math.floor(Math.random() * 15);
            const nodes = [];

            const atomGeo = new THREE.SphereGeometry(0.4, 32, 32);

            // CPK Coloringish
            const colors = [0x333333, 0xff0000, 0x0000ff, 0xffffff, 0xffff00]; // C, O, N, H, S

            for (let i = 0; i < nodeCount; i++) {
                const mat = new THREE.MeshPhysicalMaterial({
                    color: colors[Math.floor(Math.random() * colors.length)],
                    roughness: 0.2, metalness: 0.3, clearcoat: 1.0
                });
                const atom = new THREE.Mesh(atomGeo, mat);

                // Random position connected to previous
                if (i === 0) {
                    atom.position.set(0, 0, 0);
                } else {
                    const parent = nodes[Math.floor(Math.random() * nodes.length)];
                    const offset = new THREE.Vector3(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5).normalize().multiplyScalar(1.2);
                    atom.position.copy(parent.position).add(offset);

                    // Add bond
                    const bondGeo = new THREE.CylinderGeometry(0.1, 0.1, 1.2);
                    const bondMat = new THREE.MeshStandardMaterial({ color: 0x888888 });
                    const bond = new THREE.Mesh(bondGeo, bondMat);
                    bond.position.copy(parent.position).add(atom.position).multiplyScalar(0.5);
                    bond.lookAt(atom.position);
                    bond.rotateX(Math.PI / 2);
                    group.add(bond);
                }

                nodes.push(atom);
                group.add(atom);
            }

            // Center the group
            const box = new THREE.Box3().setFromObject(group);
            const center = box.getCenter(new THREE.Vector3());
            group.position.sub(center);

            return group;
        }

        function createMolecule(def) {
            let mesh;
            if (def.complex) {
                mesh = generateProceduralMolecule(def.name);
            } else {
                // Simple hardcoded ones
                const group = new THREE.Group();
                const atomGeo = new THREE.SphereGeometry(0.5, 32, 32);

                def.atoms.forEach(a => {
                    let color = 0xffffff;
                    if (a.e === 'O') color = 0xff0000;
                    if (a.e === 'C') color = 0x333333;

                    const mat = new THREE.MeshPhysicalMaterial({ color: color, roughness: 0.2, clearcoat: 1.0 });
                    const atom = new THREE.Mesh(atomGeo, mat);
                    atom.position.set(a.x, a.y, a.z);
                    group.add(atom);
                    // Add bonds? (Skip for simple demo unless requested)
                });
                mesh = group;
            }

            // Random placement in view
            mesh.position.set((Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10);
            mesh.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);

            // Add floating animation data
            mesh.userData = {
                rotSpeed: new THREE.Vector3(Math.random() * 0.02, Math.random() * 0.02, Math.random() * 0.02),
                floatOffset: Math.random() * 100
            };

            activeMolecules.add(mesh);
            updateStats();
        }

        function updateStats() {
            document.getElementById('mol-count').innerText = activeMolecules.children.length;
        }

        // --- UI Logic ---
        const listEl = document.getElementById('molecule-list');
        const logEl = document.getElementById('ai-log');

        function log(msg) {
            const div = document.createElement('div');
            div.innerText = `> ${msg}`;
            logEl.prepend(div);
        }

        MOLECULES.forEach((mol, idx) => {
            const div = document.createElement('div');
            div.className = 'mol-item';
            div.innerHTML = `<span>${mol.name}</span><span style="color:#666">${mol.formula}</span>`;
            div.onclick = () => {
                log(`Synthesizing ${mol.name}... via NVIDIA Kernels...`);
                createMolecule(mol);
            };
            listEl.appendChild(div);
        });

        document.getElementById('btn-add-water').onclick = () => {
            log("Injecting Solvent (1000 particles)...");
            initWater(waterSystem.count + 1000);
        };

        document.getElementById('btn-clear').onclick = () => {
            log("Purging Chamber...");
            while (activeMolecules.children.length > 0) {
                activeMolecules.remove(activeMolecules.children[0]);
            }
            updateStats();
        };

        document.getElementById('btn-sim-physics').onclick = () => {
            log("Running Simulation Loop [NVIDIA_WARP backend mock]...");
            // Add a little 'jolt' to everything
            activeMolecules.children.forEach(m => {
                m.userData.rotSpeed.addScalar(0.05);
            });
            setTimeout(() => log("Simulation converged. Energy minimized."), 1000);
        };


        // --- Animation Loop ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);

            const time = clock.getElapsedTime();

            controls.update();

            // Animate Water (gentle wave)
            // Note: InstancedMesh individual animation requires updating attribute every frame, expensive for CPU.
            // For demo, we just rotate the whole system slowly.
            if (waterSystem) {
                waterSystem.rotation.y = time * 0.05;
                waterSystem.rotation.z = Math.sin(time * 0.1) * 0.05;
            }

            // Animate Molecules
            activeMolecules.children.forEach(mol => {
                mol.rotation.x += mol.userData.rotSpeed.x;
                mol.rotation.y += mol.userData.rotSpeed.y;
                mol.rotation.z += mol.userData.rotSpeed.z;
                mol.position.y += Math.sin(time + mol.userData.floatOffset) * 0.005;
            });

            composer.render();
        }

        log("System Initialized. Ready for input.");
        animate();

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>

</html>